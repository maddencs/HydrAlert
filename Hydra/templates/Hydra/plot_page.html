<!DOCTYPE html>

{% load staticfiles %}
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="{% static 'main.css' %}"/>
    <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.css' %}">
</head>
<body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>

        var request = new XMLHttpRequest();
        var greenSrc = '{% static 'icons_lights_green.png' %}';
        var redSrc = '{% static 'icons_lights_red.png' %}';
        var draw = function(data) {
            var plotPersonalID = 1;
            document.getElementById('plotDiv').innerHTML = "";
            for (var p = 0; p < data['plot_list'].length; p++) {
                var plot = data['plot_list'][p];
                var plotElement = document.createElement("article");
                var resList = data['res_list'];
                var plotResUL = document.createElement("ul");
                plotResUL.classList.add('col-md-5');
                var resPersonalID = 1;
                var plotUrl = document.createElement("a");
                var greenLight = document.createElement("img");
                var redLight = document.createElement("img");
                var plotLILights = document.createElement("span");
                var plotDetails = document.createElement("div");
                var plotDropDown = document.getElementById('plotDropDown');
                var plotOption = document.createElement("option");
                plotOption.innerHTML = plotPersonalID;
                plotOption.value = plot.id;
                plotOption.classList.add('col-md-2');
                plotDropDown.appendChild(plotOption);
                plotDetails.id = "plotDetails";
                greenLight.setAttribute("src", greenSrc);
                redLight.setAttribute("src", redSrc);
                plotElement.classList.add('col-md-4');
                if( plot.alert_status == true ){
                    plotElement.classList.add('plotAlert');
                    plotElement.addEventListener("mouseover", function() {
                        this.classList.add('plotAlertMouseover');
                    });
                    plotElement.addEventListener("mouseout", function() {
                        this.classList.remove('plotAlertMouseover');
                    });
                   } else {
                    plotElement.classList.add('PlotBox');
                    plotElement.addEventListener("mouseover", function () {
                        this.classList.add('plotMouseOver');
                    });
                    plotElement.addEventListener("mouseout", function () {
                        this.classList.remove('plotMouseOver');
                    });
                }
                plotUrl.setAttribute("href", ("/Hydra/" + plot.id + "/plotmod/"));
                plotUrl.innerHTML = "Plot ID: " + plotPersonalID;
                plotElement.appendChild(plotDetails);
                plotDetails.appendChild(plotUrl);
                var anotherBr = document.createElement("br");
                plotDetails.appendChild(anotherBr);
                plotDetails.appendChild(plotLILights);
                plotDetails.appendChild(plotResUL);
                plotResUL.classList.add('list-unstyled');
                if(plot.light_status == true){
                    plotLILights.innerHTML = "Light Status: ";
                    plotLILights.appendChild(greenLight);
                } else {
                    plotLILights.innerHTML = "Light Status: ";
                    plotLILights.appendChild(redLight);
                }
                plotPersonalID++;
                for (var r = 0; r < resList.length; r++) {
                    var res = resList[r];
                    var resUL = document.createElement('dl');
                    resUL.classList.add('dl-horizontal');
                    plotElement.appendChild(resUL);
                    if (res.plot == plot.id) {
                        var resUrl = document.createElement("dt");
                        var resLIpH = document.createElement("dt");
                        var resLIPPM = document.createElement("dt");
                        var br = document.createElement("br");
                        var resATag = document.createElement("a");
                        var stat_pH = document.createElement("dd");
                        var stat_ppm = document.createElement("dd");
                        resATag.innerHTML = "Reservoir ID: " + resPersonalID;
                        resUrl.appendChild(resATag);

                        resUrl.setAttribute("href", ("/Hydra/" + res.id + "/resmod/"));
                        resLIpH.innerHTML = "Current pH:";
                        stat_pH.innerHTML = res.current_ph;
                        resLIPPM.innerHTML = "Current PPM: ";
                        stat_ppm.innerHTML = res.current_ppm;
{#                        resUL.classList.add('list-unstyled');#}
                        plotResUL.appendChild(resUrl);
                        plotResUL.appendChild(resUL);
                        plotResUL.appendChild(br);
                        resUL.appendChild(resLIpH);
                        resUL.appendChild(stat_pH);
                        resUL.appendChild(resLIPPM);
                        resUL.appendChild(stat_ppm);
                        resPersonalID++;
                    }
                }

                document.getElementById('plotDiv').appendChild(plotElement);
{#                setTimeout(grabData, 1000);#}
            }
        };

        var onRequestChange = function() {
            if ((request.readyState == 4) && (request.status == 200)) {
                var data = JSON.parse(request.responseText);
                draw(data);
            }
        };

        var grabData = function () {
            request.onreadystatechange = onRequestChange;
            request.open("GET", "/Hydra/data_grab/", true);
            request.send();
        };
        grabData()
    </script>

    <header>HydrA</header>
        <div id="menuWrap">
        <ul id="menuBar">
            <li id="plotPage">Plot List</li>
            <li id="addPlot">Add Plot</li>
            <li id="addReservoir">Add Reservoir</li>
            <li id="logOut"><a href="/Hydra/logout/">Logout</a></li>
            <li id="logIn">Log In</li>
            <li id="changeInfo">Change Personal Info</li>
            <div id="logInDiv">
                <form action="/Hydra/login/" method="POST">
                    {% csrf_token %}
                    <label for="username">Username: </label>
                    <input name="username" id="username" type="text">
                    <label for="password">Password: </label>
                    <input name="password" id="password" type="password">
                    <input type="submit" value="Login">
                </form>
            </div>
            <div id="addPlotDiv">
                <form action="/Hydra/add_plot/" method="POST">
                    {% csrf_token %}
                    <label for="light_start">Lights Start Time: </label>
                    <input id="light_start" name ="light_start" type="time">
                    <label for="light_stop">Lights Stop Time: </label>
                    <input id="light_stop" name="light_stop" type="time">
                    <label for="goal_temp">Goal Temperature: </label>
                    <input id="goal_temp" name="goal_temp" type="number" min="0" max="120">
                    <label for="goal_humid">Goal Humidity: </label>
                    <input id="goal_humid" name="goal_humid" type="number" min="0" max="100">
                    <input type="submit" value="Create Plot">
                </form>
            </div>
        </ul>
            <div id="addResDiv">
                <form class="row2" action="/Hydra/add_res/" method="POST">
                    {% csrf_token %}
                    <label for="plot">Plot: </label>
                    <select id="plotDropDown" name="plot" class="form-control">
                    </select>
{#                    <input id="plot" name="plot" type="number" min="0" max="{{ dropdown_plot_list.length }}">#}
                    <label for="goal_ph_low">pH Lower Limit: </label>
                    <input id="goal_ph_low" name="goal_ph_low" type="number" step=".1">
                    <label for="goal_ph_high">pH Upper Limit: </label>
                    <input id="goal_ph_high" name="goal_ph_high" type="number" step=".1">
                    <label for="goal_ppm">Goal PPM: </label>
                    <input id="goal_ppm" name="goal_ppm" type="number">
                    <input type="submit" value="Add Reservoir">
                </form>
            </div>
    </div>
    <br>
    <h1>{{ message }}</h1>
    <div id="plotDiv"></div>
    <script>
{#        forms#}
        $("li[id='logIn']").click(function(){
            $("#logInDiv").toggle('slow');
        });
        $("li[id='addPlot']").click(function(){
            $("#addPlotDiv").toggle('slow');
        });
        $("li[id='addReservoir']").click(function(){
            $("#addResDiv").toggle('slow');
        });
    </script>
</body>
</html>
